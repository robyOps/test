{% extends "base.html" %}
{% load perm_labels %}
{% block title %}Roles{% endblock %}

{% block content %}
<section class="page-section">
  <header class="surface-panel">
    <div class="flex flex-col gap-6 lg:flex-row lg:items-center lg:justify-between">
      <div class="space-y-4">
        <span class="page-eyebrow">Roles</span>
        <h1 class="page-title">Gestión de roles</h1>
        <p class="page-subtitle">Diseña perfiles a medida, controla permisos y mantiene a cada equipo con las herramientas adecuadas.</p>
      </div>
      <a href="{% url 'accounts:role_create' %}" class="btn btn-primary"><i class="bi bi-plus-circle"></i> Nuevo rol</a>
    </div>
  </header>

  {% if roles %}
  <div class="grid gap-5 lg:grid-cols-2">
    {% for r in roles %}
    <article class="surface-panel surface-panel--contrast space-y-5">
      <div class="flex flex-col gap-3 sm:flex-row sm:items-start sm:justify-between">
        <div class="space-y-1">
          <h2 class="heading-md text-contrast">{{ r.name }}</h2>
          <p class="text-sm text-contrast-soft">Permisos activos para este rol.</p>
        </div>
        <a class="btn btn-ghost" href="{% url 'accounts:role_edit' r.id %}"><i class="bi bi-pencil"></i> Editar</a>
      </div>
      {% with perms=r.permissions.all|perm_known %}
        {% if perms %}
          <ul class="flex flex-wrap gap-2" role="list">
            {% for p in perms %}
            <li class="pill pill--muted text-xs"><i class="bi bi-check-circle-fill text-accent"></i>{{ p|perm_label }}</li>
            {% endfor %}
          </ul>
        {% else %}
          <p class="surface-note text-sm">Este rol aún no tiene permisos asignados.</p>
        {% endif %}
      {% endwith %}
    </article>
    {% endfor %}
  </div>
  {% else %}
  <div class="empty-state">
    <i class="bi bi-folder text-3xl text-slate-300"></i>
    <p class="text-base">Todavía no se han creado roles. Crea uno para comenzar a delegar responsabilidades.</p>
  </div>
  {% endif %}
</section>
{% endblock %}
