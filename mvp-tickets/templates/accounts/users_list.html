{% extends "base.html" %}
{% load static %}
{% block title %}Usuarios{% endblock %}

{% block content %}
<div class="space-y-8">
  <header class="rounded-3xl border border-indigo-100 bg-gradient-to-br from-indigo-600 via-blue-500 to-sky-400 p-6 text-white shadow">
    <div class="flex flex-col gap-4 md:flex-row md:items-center md:justify-between">
      <div class="space-y-2">
        <p class="inline-flex items-center gap-2 rounded-full bg-white/20 px-3 py-1 text-xs font-semibold uppercase tracking-[0.35em]">Equipo</p>
        <h1 class="text-3xl font-bold tracking-tight">Usuarios</h1>
        <p class="max-w-xl text-sm text-blue-100">Administra las cuentas del helpdesk y mantén a todos con los permisos correctos.</p>
      </div>
      <a href="{% url 'accounts:user_create' %}" class="btn inline-flex items-center gap-2 rounded-full bg-white px-5 py-2 text-sm font-semibold text-indigo-700 shadow-lg shadow-indigo-900/20 transition hover:bg-indigo-50">
        <i class="bi bi-person-plus"></i>
        Nuevo usuario
      </a>
    </div>
  </header>

  <section class="grid gap-6 lg:grid-cols-[minmax(0,18rem)_1fr]">
    <aside class="space-y-6">
      <article class="rounded-3xl border border-slate-200 bg-white p-6 shadow-sm">
        <h2 class="text-lg font-semibold text-slate-900">Filtros</h2>
        <p class="mt-1 text-sm text-slate-500">Acota por actividad, grupo o busca por nombre para encontrar rápido a la persona.</p>
        <form method="get" class="mt-4 space-y-4 text-sm">
          <div class="space-y-1">
            <label class="text-xs font-semibold uppercase text-slate-500" for="buscar-usuario">Buscar</label>
            <input id="buscar-usuario" name="q" value="{{ filters.q }}" class="w-full rounded-xl border border-slate-200 px-3 py-2 focus:border-indigo-400 focus:outline-none focus:ring-2 focus:ring-indigo-100" placeholder="usuario, nombre, email" />
          </div>
          <div class="space-y-1">
            <label class="text-xs font-semibold uppercase text-slate-500" for="activo">Activo</label>
            <select id="activo" name="active" class="w-full rounded-xl border border-slate-200 px-3 py-2 focus:border-indigo-400 focus:outline-none focus:ring-2 focus:ring-indigo-100">
              <option value="" {% if not filters.active %}selected{% endif %}>(Todos)</option>
              <option value="1" {% if filters.active == "1" %}selected{% endif %}>Sí</option>
              <option value="0" {% if filters.active == "0" %}selected{% endif %}>No</option>
            </select>
          </div>
          <div class="space-y-1">
            <label class="text-xs font-semibold uppercase text-slate-500" for="grupo">Grupo</label>
            <select id="grupo" name="group" class="w-full rounded-xl border border-slate-200 px-3 py-2 focus:border-indigo-400 focus:outline-none focus:ring-2 focus:ring-indigo-100">
              <option value="" {% if not filters.group %}selected{% endif %}>(Todos)</option>
              {% for g in groups %}
                <option value="{{ g.id }}" {% if filters.group == g.id|stringformat:'s' %}selected{% endif %}>{{ g.name }}</option>
              {% endfor %}
            </select>
          </div>
          <div class="flex flex-wrap items-center gap-2 pt-1">
            <button class="btn inline-flex items-center gap-2 rounded-full bg-indigo-600 px-4 py-2 font-semibold text-white shadow hover:bg-indigo-700" type="submit">
              <i class="bi bi-funnel"></i>
              Filtrar
            </button>
            <a href="{% url 'accounts:users_list' %}" class="btn inline-flex items-center gap-2 rounded-full border border-slate-200 px-4 py-2 font-semibold text-slate-600 hover:border-indigo-200 hover:text-indigo-600">
              <i class="bi bi-eraser"></i>
              Limpiar
            </a>
          </div>
        </form>
      </article>
      <p class="rounded-2xl border border-slate-200 bg-white p-4 text-xs text-slate-500">Consejo: documenta los cambios relevantes en roles para mantener la trazabilidad.</p>
    </aside>

    <div class="space-y-4">
      <article class="overflow-hidden rounded-3xl border border-slate-200 bg-white shadow-sm">
        <div class="flex items-center justify-between border-b border-slate-100 px-6 py-4">
          <h2 class="text-lg font-semibold text-slate-900">Listado de usuarios</h2>
          <p class="text-xs text-slate-500">Haz click en editar para modificar datos o activar/desactivar accesos.</p>
        </div>
        <div class="overflow-x-auto">
          <table class="min-w-full divide-y divide-slate-100 text-sm">
            <thead class="bg-slate-50 text-xs uppercase tracking-wide text-slate-600">
              <tr>
                <th scope="col" class="px-4 py-3 text-left">Usuario</th>
                <th scope="col" class="px-4 py-3 text-left">Nombre</th>
                <th scope="col" class="px-4 py-3 text-left">Email</th>
                <th scope="col" class="px-4 py-3 text-left">Grupos</th>
                <th scope="col" class="px-4 py-3 text-left">Estado</th>
                <th scope="col" class="px-4 py-3 text-left">Acciones</th>
              </tr>
            </thead>
            <tbody class="divide-y divide-slate-100">
              {% for u in users %}
              <tr class="transition hover:bg-slate-50">
                <td class="px-4 py-3 font-medium text-slate-800">{{ u.username }}</td>
                <td class="px-4 py-3 text-slate-600">{{ u.first_name }} {{ u.last_name }}</td>
                <td class="px-4 py-3 text-slate-600">{{ u.email }}</td>
                <td class="px-4 py-3">
                  <div class="flex flex-wrap gap-2">
                    {% for g in u.groups.all %}
                      <span class="inline-flex items-center gap-2 rounded-full border border-slate-200 bg-slate-50 px-3 py-1 text-xs font-medium text-slate-600"><i class="bi bi-shield-check text-indigo-400"></i>{{ g.name }}</span>
                    {% empty %}
                      <span class="text-xs text-slate-400">—</span>
                    {% endfor %}
                  </div>
                </td>
                <td class="px-4 py-3">
                  {% if u.is_active %}
                    <span class="inline-flex items-center gap-1 rounded-full bg-emerald-100 px-3 py-1 text-xs font-semibold text-emerald-700"><i class="bi bi-check-circle"></i>Activo</span>
                  {% else %}
                    <span class="inline-flex items-center gap-1 rounded-full bg-rose-100 px-3 py-1 text-xs font-semibold text-rose-700"><i class="bi bi-x-circle"></i>Inactivo</span>
                  {% endif %}
                </td>
                <td class="px-4 py-3">
                  <div class="flex flex-wrap items-center gap-3 text-xs font-semibold">
                    <a class="text-indigo-600 hover:text-indigo-800" href="{% url 'accounts:user_edit' u.id %}"><i class="bi bi-pencil"></i> Editar</a>
                    <a class="text-slate-500 hover:text-rose-600"
                       href="{% url 'accounts:user_toggle' u.id %}"
                       onclick="return confirm('¿Seguro? Cambiarás el estado de este usuario.');">
                      <i class="bi bi-arrow-repeat"></i> {{ u.is_active|yesno:"Desactivar,Activar" }}
                    </a>
                  </div>
                </td>
              </tr>
              {% empty %}
              <tr>
                <td class="px-4 py-6 text-center text-sm text-slate-500" colspan="6">Sin resultados en este momento.</td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </article>
    </div>
  </section>
</div>
{% endblock %}

