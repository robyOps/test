{% extends "base.html" %}
{% block title %}Auto-asignación{% endblock %}
{% block content %}
<div class="space-y-8">
  <header class="surface-panel surface-panel--gradient">
    <div class="flex flex-col gap-4 md:flex-row md:items-center md:justify-between">
      <div class="space-y-2">
        <span class="pill pill--accent text-xs uppercase tracking-[0.35em]">Automatización</span>
        <h1 class="page-title text-contrast">Reglas de auto-asignación</h1>
        <p class="text-sm text-contrast-soft">Configura combinaciones de categoría, área y técnico para agilizar el enrutamiento.</p>
      </div>
      <a href="{% url 'auto_rule_create' %}" class="btn btn-primary"><i class="bi bi-magic"></i> Nueva regla</a>
    </div>
  </header>

  <article class="surface-panel surface-panel--contrast space-y-4">
    <div class="panel-header flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between">
      <h2 class="heading-md text-contrast">Listado de reglas</h2>
      <p class="text-xs text-contrast-soft">Edita o activa/desactiva según la disponibilidad del equipo.</p>
    </div>
    <div class="overflow-x-auto">
      <table class="table text-sm">
        <thead>
          <tr>
            <th scope="col" class="th">Categoría</th>
            <th scope="col" class="th">Área</th>
            <th scope="col" class="th">Técnico</th>
            <th scope="col" class="th">Activa</th>
            <th scope="col" class="th">Acciones</th>
          </tr>
        </thead>
        <tbody>
          {% for r in rules %}
          <tr>
            <td class="td text-muted">{{ r.category.name|default:"—" }}</td>
            <td class="td text-muted">{{ r.area.name|default:"—" }}</td>
            <td class="td font-semibold">{{ r.tech.username }}</td>
            <td class="td">
              {% if r.is_active %}
                <span class="pill pill--success text-xs"><i class="bi bi-check-circle"></i> Sí</span>
              {% else %}
                <span class="pill pill--muted text-xs"><i class="bi bi-pause-circle"></i> No</span>
              {% endif %}
            </td>
            <td class="td">
              <div class="flex flex-wrap items-center gap-3 text-xs font-semibold">
                <a href="{% url 'auto_rule_edit' r.id %}" class="text-accent hover:underline"><i class="bi bi-pencil"></i> Editar</a>
                <form method="post" action="{% url 'auto_rule_toggle' r.id %}" class="inline" onsubmit="return confirm('¿Quieres alternar el estado de la regla?');">
                  {% csrf_token %}
                  <button class="text-warning hover:text-warning" title="Activar/Desactivar">
                    <i class="bi bi-arrow-repeat"></i> Alternar
                  </button>
                </form>
                <form method="post" action="{% url 'auto_rule_delete' r.id %}" class="inline" onsubmit="return confirm('¿Eliminar regla?');">
                  {% csrf_token %}
                  <button class="text-danger hover:text-danger">
                    <i class="bi bi-trash"></i> Eliminar
                  </button>
                </form>
              </div>
            </td>
          </tr>
          {% empty %}
          <tr>
            <td class="td text-center text-sm text-muted-soft" colspan="5">Todavía no se han definido reglas automáticas.</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </article>
</div>
{% endblock %}
